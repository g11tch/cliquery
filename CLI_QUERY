#!/bin/bash
#AUTHOR: Hunter Hammond
#VERSION: 2.0

KW="$@" # kwargs
BROWSER="iceweasel"
INCOG="-private-window"
SOURCE="${BASH_SOURCE[0]}"
while [ -h "$SOURCE" ]; do # resolve $SOURCE until the file is no longer a symlink
    DIR="$( cd -P "$( dirname "$SOURCE" )" && pwd )"
    SOURCE="$(readlink "$SOURCE")"
    [[ $SOURCE != /* ]] && SOURCE="$DIR/$SOURCE" # if $SOURCE was a relative symlink, we need to resolve it relative to the path where the symlink file was located
done
DIR="$( cd -P "$( dirname "$SOURCE" )" && pwd )"

bing () {
    BING=$(python $DIR/bing.py $KW)
    if echo $BING | grep -q "BingFail" ; then
        exit 0
    fi
}

wolf () {
    WOLF=$(python $DIR/wolfram.py $KW)
    if echo $WOLF | grep -q "WolfFail" ; then
        exit 0
    fi
}

bingpage () {
    BING=${BING%$'BingPage'}
    if [[ $BING = 'q' ]] ; then
        exit 0
    else
        $BROWSER $BING &
    fi
}

bingincogpage() {
    BING=${BING%$'BingIncogPage'}
    if [[ $BING = 'q' ]] ; then
        exit 0
    else
        $BROWSER $INCOG $BING &
    fi
}

bing
if echo $BING | grep -q "WolfFlag" ; then # Check for -w flag
    wolf
    if echo $WOLF | grep -q "WolfNoMatch" ; then 
        KW="-s "$KW # If no result then force -s flag
        bing
        if echo $BING | grep -q "BingPage" ; then
            bingpage
        elif echo $BING | grep -q "BingIncogPage" ; then
            bingincogpage
        fi
    else
        echo $WOLF
    fi
elif echo $BING | grep -q "BingOpen" ; then # Check for -o flag
    BING=${BING%$'BingOpen'}
    $BROWSER $BING &
elif echo $BING | grep -q "BingIncogOpen" ; then
    BING=${BING%$'BingIncogOpen'}
    $BROWSER $INCOG $BING &
elif echo $BING | grep -q "BingFL" ; then # Check for -f flag
    BING=${BING%$'BingFL'}
    $BROWSER $BING &
elif echo $BING | grep -q "BingIncogFL" ; then
    BING=${BING%$'BingIncogFL'}
    $BROWSER $INCOG $BING &
elif echo $BING | grep -q "BingPage" ; then # Return Bing links to follow
    bingpage
elif echo $BING | grep -q "BingIncogPage" ; then
    bingincogpage
elif echo $BING | grep -q "BingCalc" ; then # Return Bing calculation
    BING=${BING%$'BingCalc'}
    echo $BING
else                                        # Return Wolf calculation
    exit 0
fi
